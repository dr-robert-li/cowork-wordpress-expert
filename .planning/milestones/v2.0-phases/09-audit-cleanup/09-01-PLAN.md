---
phase: 09-audit-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/diagnose/COMMAND.md
  - .claude-plugin/plugin.json
  - commands/status/COMMAND.md
autonomous: true
requirements: []
gap_closure: true

must_haves:
  truths:
    - "trend-tracker receives scalar SKILLS_COMPLETED and SKILLS_TOTAL values (not array references)"
    - "plugin.json lists all 21 skills (10 v1 + 11 v2)"
    - "plugin.json diagnose description mentions performance mode"
    - "/status Available Commands footer lists performance as a diagnose mode"
  artifacts:
    - path: "commands/diagnose/COMMAND.md"
      provides: "Corrected variable assignment before trend-tracker invocation"
      contains: "SKILLS_COMPLETED=${#SKILLS_COMPLETED[@]}"
    - path: ".claude-plugin/plugin.json"
      provides: "Complete skills manifest and updated diagnose description"
      contains: "diagnostic-db-autoload"
    - path: "commands/status/COMMAND.md"
      provides: "Updated Available Commands footer with performance mode"
      contains: "performance"
  key_links:
    - from: "commands/diagnose/COMMAND.md"
      to: "skills/trend-tracker/SKILL.md"
      via: "SKILLS_COMPLETED and SKILLS_TOTAL scalar variables"
      pattern: "SKILLS_COMPLETED=.*\\$\\{#SKILLS_COMPLETED"
---

<objective>
Close all gaps identified by the v2.0 milestone audit: fix the skill_coverage variable mismatch between /diagnose and trend-tracker, add all 11 missing v2 skills to plugin.json, update diagnose description to include performance mode, and add performance to /status footer.

Purpose: Final cleanup before v2.0 milestone archival — ensures manifest accuracy and fixes the one functional display bug.
Output: Three updated files with all audit gaps closed.
</objective>

<execution_context>
@/Users/robertli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v2.0-MILESTONE-AUDIT.md
@commands/diagnose/COMMAND.md
@.claude-plugin/plugin.json
@commands/status/COMMAND.md
@skills/trend-tracker/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix skill_coverage variable mismatch in /diagnose Section 5.5</name>
  <files>commands/diagnose/COMMAND.md</files>
  <action>
In commands/diagnose/COMMAND.md Section 5.5, find the trend-tracker invocation block (around lines 618-620) where SKILLS_COMPLETED_COUNT and SKILLS_TOTAL_COUNT are computed.

Currently the code computes these into _COUNT-suffixed variables but trend-tracker expects SKILLS_COMPLETED and SKILLS_TOTAL as scalars (per skills/trend-tracker/SKILL.md Step 7 which does "${SKILLS_COMPLETED}/${SKILLS_TOTAL}").

Add two reassignment lines AFTER the count computation and BEFORE the trend-tracker invocation comment. The block should read:

```bash
# SKILLS_COMPLETED count from Section 4 tracking
SKILLS_COMPLETED_COUNT="${#SKILLS_COMPLETED[@]}"
SKILLS_TOTAL_COUNT="${#SKILLS[@]}"

# Re-assign as scalars for trend-tracker (expects SKILLS_COMPLETED and SKILLS_TOTAL as integers)
SKILLS_COMPLETED="${SKILLS_COMPLETED_COUNT}"
SKILLS_TOTAL="${SKILLS_TOTAL_COUNT}"
```

This overwrites the array variable SKILLS_COMPLETED with its scalar count, which is safe because the array is not referenced after this point in the command flow. The trend-tracker then receives the correct scalar values for the skill_coverage field in trends.json.

Do NOT rename the existing _COUNT variables — they document intent. Just add the two reassignment lines.
  </action>
  <verify>Grep commands/diagnose/COMMAND.md for 'SKILLS_COMPLETED="${SKILLS_COMPLETED_COUNT}"' — must find exactly 1 match. Grep for 'SKILLS_TOTAL="${SKILLS_TOTAL_COUNT}"' — must find exactly 1 match. Verify both lines appear BEFORE the "(Implementation follows skills/trend-tracker/SKILL.md specification)" comment.</verify>
  <done>SKILLS_COMPLETED and SKILLS_TOTAL are scalar integers when trend-tracker runs, matching the variable names trend-tracker expects for skill_coverage computation.</done>
</task>

<task type="auto">
  <name>Task 2: Update plugin.json with all v2 skills and performance mode</name>
  <files>.claude-plugin/plugin.json</files>
  <action>
Update .claude-plugin/plugin.json with two changes:

1. **Update diagnose command description** (line 18) from:
   "Run diagnostic suite with full, security-only, or code-only modes on connected WordPress sites"
   to:
   "Run diagnostic suite with full, security-only, code-only, or performance modes on connected WordPress sites"

2. **Add 11 missing skills** to the "skills" object, after "scan-reviewer". Add these entries in the order they were created (Phases 6-8):

   - "diagnostic-db-autoload": "WordPress autoload option analysis for bloat detection and plugin attribution"
   - "diagnostic-db-transients": "Transient health analysis for expired buildup and cleanup threshold recommendations"
   - "diagnostic-db-revisions": "Post revision analysis by type with storage impact and revision limit recommendations"
   - "diagnostic-https-audit": "HTTPS/SSL configuration audit for siteurl scheme, FORCE_SSL_ADMIN, and mixed content indicators"
   - "diagnostic-file-permissions": "File and directory permission audit against WordPress security recommendations"
   - "diagnostic-performance-n1": "N+1 query pattern detection in theme and plugin code with confidence ratings"
   - "diagnostic-cron-analysis": "WP-Cron event analysis for overdue, duplicate, and excessively-frequent scheduled jobs"
   - "diagnostic-wpcli-profile": "WP-CLI Profile stage and hook timing analysis for performance bottleneck identification"
   - "diagnostic-architecture": "Architecture review for CPT misuse, hook abuse patterns, and caching anti-patterns"
   - "diagnostic-arch-narrative": "AI-synthesized architectural health narrative aggregating findings across all diagnostic domains"
   - "trend-tracker": "Cross-scan trend tracking with NEW/RESOLVED/RECURRING classification and inline report badges"

   All entries should have "status": "implemented".

   Ensure valid JSON — proper comma placement after the last existing skill entry ("scan-reviewer") and no trailing comma after the last new entry ("trend-tracker").
  </action>
  <verify>Run: `cat .claude-plugin/plugin.json | python3 -m json.tool > /dev/null && echo "Valid JSON"` — must print "Valid JSON". Count skills with: `python3 -c "import json; d=json.load(open('.claude-plugin/plugin.json')); print(len(d['skills']))"` — must print 21. Grep for "performance" in the diagnose description.</verify>
  <done>plugin.json contains all 21 skills (10 original + 11 new) and diagnose description includes "performance" mode.</done>
</task>

<task type="auto">
  <name>Task 3: Add performance mode to /status Available Commands footer</name>
  <files>commands/status/COMMAND.md</files>
  <action>
In commands/status/COMMAND.md, find the Available Commands echo block (around line 223). Change:

```bash
echo "- /diagnose [mode] [on site-name] -- Run diagnostic scan (modes: full, security only, code only)"
```

to:

```bash
echo "- /diagnose [mode] [on site-name] -- Run diagnostic scan (modes: full, security only, code only, performance)"
```

This is a single-line change — just add ", performance" before the closing parenthesis.
  </action>
  <verify>Grep commands/status/COMMAND.md for "performance" — must find at least 1 match in the Available Commands section.</verify>
  <done>/status footer lists all four diagnose modes: full, security only, code only, performance.</done>
</task>

</tasks>

<verification>
After all three tasks complete:
1. `python3 -c "import json; d=json.load(open('.claude-plugin/plugin.json')); print('Skills:', len(d['skills'])); print('Perf in diagnose:', 'performance' in d['commands']['diagnose']['description'])"` — prints "Skills: 21" and "Perf in diagnose: True"
2. Grep commands/diagnose/COMMAND.md for 'SKILLS_COMPLETED="\${SKILLS_COMPLETED_COUNT}"' — 1 match
3. Grep commands/status/COMMAND.md for 'performance' in the diagnose line — 1 match
4. All five success criteria from Phase 9 roadmap entry are satisfied (MSRC-06 was already fixed pre-phase)
</verification>

<success_criteria>
- skill_coverage variable in /diagnose Section 5.5 correctly passes scalar counts to trend-tracker
- plugin.json skills manifest lists all 21 skills (10 from v1 + 11 from v2)
- plugin.json diagnose description includes "performance" mode
- /status Available Commands footer includes "performance" in diagnose modes
</success_criteria>

<output>
After completion, create `.planning/phases/09-audit-cleanup/09-01-SUMMARY.md`
</output>
