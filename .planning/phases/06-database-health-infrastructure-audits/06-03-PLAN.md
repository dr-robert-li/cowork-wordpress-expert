---
phase: 06-database-health-infrastructure-audits
plan: 03
type: execute
wave: 2
depends_on:
  - 06-01
  - 06-02
files_modified:
  - commands/diagnose/COMMAND.md
autonomous: true
requirements:
  - DBHL-01
  - DBHL-02
  - DBHL-03
  - INFR-01
  - INFR-02

must_haves:
  truths:
    - "All five new skills appear in the full mode SKILLS array in /diagnose"
    - "Three DB skills (diagnostic-db-autoload, diagnostic-db-transients, diagnostic-db-revisions) are added to the WP_CLI_SKILLS array"
    - "HTTPS audit and file permissions skills are NOT in WP_CLI_SKILLS (they self-gate)"
    - "Capability summary in /diagnose includes database health, HTTPS audit, and file permissions entries"
    - "Mode descriptions updated to reflect new skill count (full mode now runs 11 skills)"
  artifacts:
    - path: "commands/diagnose/COMMAND.md"
      provides: "Updated diagnose command with all Phase 6 skills registered"
      contains: "diagnostic-db-autoload"
  key_links:
    - from: "commands/diagnose/COMMAND.md"
      to: "skills/diagnostic-db-autoload/SKILL.md"
      via: "SKILLS array entry"
      pattern: "diagnostic-db-autoload:Autoload Bloat"
    - from: "commands/diagnose/COMMAND.md"
      to: "skills/diagnostic-https-audit/SKILL.md"
      via: "SKILLS array entry"
      pattern: "diagnostic-https-audit:HTTPS"
---

<objective>
Register all five new Phase 6 diagnostic skills in the /diagnose command, update the WP_CLI_SKILLS array, and update mode descriptions and capability summaries.

Purpose: Wire the new skills into the existing diagnostic workflow so they execute as part of full-mode scans and are properly gated by source type.

Output: Updated commands/diagnose/COMMAND.md with 5 new skill registrations
</objective>

<execution_context>
@/Users/robertli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-database-health-infrastructure-audits/06-01-SUMMARY.md
@.planning/phases/06-database-health-infrastructure-audits/06-02-SUMMARY.md
@commands/diagnose/COMMAND.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register Phase 6 skills in /diagnose command</name>
  <files>commands/diagnose/COMMAND.md</files>
  <action>
Update `commands/diagnose/COMMAND.md` with the following changes:

**1. Update frontmatter description** to mention database health and infrastructure audit skills (currently says "All 6 diagnostic skills" — update count to 11).

**2. Update the full mode SKILLS array** (Section 4, around line 267-276). Add 5 new entries after the existing 6:
```bash
  "full")
    SKILLS=(
      "diagnostic-core-integrity:Core Integrity Check"
      "diagnostic-config-security:Configuration Security"
      "diagnostic-user-audit:User Account Audit"
      "diagnostic-version-audit:Version Audit"
      "diagnostic-malware-scan:Malware Scan"
      "diagnostic-code-quality:Code Quality Analysis"
      "diagnostic-db-autoload:Autoload Bloat Analysis"
      "diagnostic-db-transients:Transient Buildup Check"
      "diagnostic-db-revisions:Post Revision Analysis"
      "diagnostic-https-audit:HTTPS Configuration Audit"
      "diagnostic-file-permissions:File Permission Check"
    )
    ;;
```

**3. Update WP_CLI_SKILLS array** (Section 4, around line 286-290). Add 3 DB skills:
```bash
WP_CLI_SKILLS=(
  "diagnostic-core-integrity"
  "diagnostic-user-audit"
  "diagnostic-version-audit"
  "diagnostic-db-autoload"
  "diagnostic-db-transients"
  "diagnostic-db-revisions"
)
```

**CRITICAL:** Do NOT add diagnostic-https-audit or diagnostic-file-permissions to WP_CLI_SKILLS. These skills handle their own gating internally:
- HTTPS audit: dual-gated (Part A checks WP_CLI_AVAILABLE, Part B always runs)
- File permissions: SSH-only (checks source_type internally)

**4. Update mode description text** — Where the command describes "Runs all 6 diagnostic skills", update to 11. Update the full mode description list to include the new skill names.

**5. Update the inline skip message text** (around line 340) — Where it says "WP-CLI-dependent skills (core-integrity, user-audit, version-audit) will be skipped", update to include the three DB skills: "WP-CLI-dependent skills (core-integrity, user-audit, version-audit, db-autoload, db-transients, db-revisions) will be skipped."

**6. Update the skipped skills summary section** — The end-of-run summary that distinguishes WP-CLI skips from execution errors should work as-is since it's array-based, but verify the display text is accurate with 6 WP-CLI skills instead of 3.

Do NOT change the security-only or code-only mode arrays — the new skills are full-mode only.
  </action>
  <verify>Read commands/diagnose/COMMAND.md and verify: (1) full mode SKILLS array has 11 entries, (2) WP_CLI_SKILLS array has 6 entries (3 original + 3 DB), (3) diagnostic-https-audit and diagnostic-file-permissions are NOT in WP_CLI_SKILLS, (4) skill count mentions updated from 6 to 11, (5) skip message text includes db-autoload, db-transients, db-revisions.</verify>
  <done>The /diagnose command registers all 5 Phase 6 skills in the full mode array, adds 3 DB skills to WP_CLI_SKILLS, leaves HTTPS and permissions skills to self-gate, and updates all descriptive text to reflect 11 total skills.</done>
</task>

</tasks>

<verification>
1. Full mode SKILLS array contains exactly 11 entries (6 existing + 5 new)
2. WP_CLI_SKILLS array contains exactly 6 entries (3 existing + 3 new DB skills)
3. diagnostic-https-audit is in SKILLS but NOT in WP_CLI_SKILLS
4. diagnostic-file-permissions is in SKILLS but NOT in WP_CLI_SKILLS
5. security-only and code-only mode arrays unchanged
6. Frontmatter and mode descriptions updated to say 11 skills
7. Skip messages list all 6 WP-CLI-dependent skills
</verification>

<success_criteria>
The /diagnose command includes all 5 new skills in the full execution path, properly gates the 3 DB skills via WP_CLI_SKILLS, and leaves the 2 infrastructure skills to self-gate. All descriptive text reflects the updated skill count.
</success_criteria>

<output>
After completion, create `.planning/phases/06-database-health-infrastructure-audits/06-03-SUMMARY.md`
</output>
