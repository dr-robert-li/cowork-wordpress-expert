---
phase: 01-plugin-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - CLAUDE.md
  - skills/security-analysis/SKILL.md
  - skills/code-quality/SKILL.md
  - skills/performance/SKILL.md
  - skills/plugin-conflicts/SKILL.md
autonomous: true

must_haves:
  truths:
    - "CLAUDE.md contains only identity, process, and hot cache sections - NO diagnostic domain knowledge"
    - "Security analysis skill contains all Domain 1 content from the original CLAUDE.md"
    - "Code quality skill contains all Domain 2 content from the original CLAUDE.md"
    - "Performance skill contains all Domain 3 content from the original CLAUDE.md"
    - "Plugin conflicts skill contains all Domain 4 content from the original CLAUDE.md"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Plugin identity, process, and active state cache"
      min_lines: 30
    - path: "skills/security-analysis/SKILL.md"
      provides: "Domain 1: Security Audit (sections 1.1-1.9)"
      contains: "sanitize_text_field"
    - path: "skills/code-quality/SKILL.md"
      provides: "Domain 2: Code Quality & Standards (sections 2.1-2.5)"
      contains: "WordPress Coding Standards"
    - path: "skills/performance/SKILL.md"
      provides: "Domain 3: Performance Analysis (sections 3.1-3.4)"
      contains: "N+1 query"
    - path: "skills/plugin-conflicts/SKILL.md"
      provides: "Domain 4: Plugin & Theme Conflict Resolution (sections 4.1-4.3)"
      contains: "Hook priority"
  key_links:
    - from: "CLAUDE.md"
      to: "skills/"
      via: "content migration"
      pattern: "diagnostic domains.+skill"
    - from: "skills/security-analysis/SKILL.md"
      to: "CLAUDE.md (original)"
      via: "extracted from Domain 1"
      pattern: "name: security-analysis"
---

<objective>
Rework CLAUDE.md into a lean identity/process/hot-cache file and extract the first four diagnostic domains into skill files.

Purpose: The existing CLAUDE.md is 850 lines containing six diagnostic domains, testing framework, and communication style. Per user decision, ALL diagnostic domains move to skills/, and CLAUDE.md becomes identity + process + hot cache only. This plan handles the CLAUDE.md rewrite and the first four domains.
Output: New CLAUDE.md (~60-80 lines) + 4 skill files with full domain knowledge transferred.
</objective>

<execution_context>
@/Users/robertli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-plugin-foundation/01-RESEARCH.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rework CLAUDE.md into lean identity and hot cache</name>
  <files>CLAUDE.md</files>
  <action>
Read the existing CLAUDE.md (all 850 lines). Then REPLACE it entirely with a new version containing ONLY:

1. **Header** with plugin name "WordPress Expert Plugin"
2. **Role section** (~2-3 paragraphs): Extract from the existing "Identity & Role" section. Keep the core identity as a senior WordPress systems analyst. Remove the detailed communication style bullets (those go to reporting skill in Plan 03).
3. **Process section**: Condense the existing "Core Principles" into a compact process guide. Keep "Ask Before You Act" discovery protocol but compress it. Keep "Evidence-Based Diagnosis" as a principle. Remove testing framework details (goes to testing skill). Remove action logging format (goes to reporting skill).
4. **Safe Operation Patterns section**: Add a brief section documenting:
   - rsync ALWAYS uses --dry-run first, then actual sync after review
   - rsync excludes wp-config.php, *.log, .git, node_modules by default
   - NEVER use rsync --delete flag (risk of deleting production files)
   - SSH credentials are never logged or included in output
   - Cross-platform note: macOS uses openrsync (not GNU rsync), test with --dry-run to verify flag compatibility
5. **Hot Cache section** with placeholder sections:
   - `## Currently Connected Site` (populated by /wpe:connect)
   - `## Active Diagnostic Session` (populated by /wpe:diagnose or /wpe:audit)
   - `## Recent Findings` (populated as diagnostics run)

The new CLAUDE.md should be approximately 60-100 lines. It must NOT contain any diagnostic domain content (Domains 1-6), testing framework details, communication style patterns, tool usage commands, or red flags list. All of that moves to skills.

Key line from user decision: "CLAUDE.md = identity/process at top + hot cache for active state below (combined approach)"
  </action>
  <verify>
Verify CLAUDE.md is under 120 lines. Verify it does NOT contain "Domain 1", "sanitize_text_field", "PHPUnit", "$wpdb->prepare" or other domain-specific content. Verify it DOES contain "WordPress Expert", "Currently Connected Site", "Active Diagnostic Session", "rsync", "dry-run".
  </verify>
  <done>CLAUDE.md is lean identity/process/hot-cache. Zero diagnostic domain knowledge remains. Safe operation patterns documented.</done>
</task>

<task type="auto">
  <name>Task 2: Create skills for Domains 1-4 from original CLAUDE.md</name>
  <files>skills/security-analysis/SKILL.md, skills/code-quality/SKILL.md, skills/performance/SKILL.md, skills/plugin-conflicts/SKILL.md</files>
  <action>
For each skill, create a SKILL.md with YAML frontmatter (name + description) followed by the FULL content extracted from the original CLAUDE.md. Do NOT summarize or truncate -- transfer the complete domain knowledge.

**skills/security-analysis/SKILL.md:**
- Frontmatter: `name: security-analysis`, `description: Evaluates WordPress codebase against OWASP Top 10 and WP-specific vulnerability patterns. Use when reviewing code security, auditing plugins/themes, or investigating security incidents.`
- Content: ALL of Domain 1 (sections 1.1 through 1.9) from the original CLAUDE.md. This includes Input Validation & Sanitization, Output Escaping, Authentication & Authorization, CSRF, SQL Injection, File Security, Data Exposure, Obfuscated/Malicious Code Detection, and Dependency & Supply Chain.
- Also include the "Quick Reference: WordPress Red Flags" section from the original CLAUDE.md at the bottom of this skill, since it's security-focused.
- Also include the security-specific grep commands from the "Tool Usage > Static Analysis Tools" section.

**skills/code-quality/SKILL.md:**
- Frontmatter: `name: code-quality`, `description: Reviews WordPress code against WPCS standards, static analysis, architecture patterns, and error handling. Use when analyzing custom themes/plugins, checking coding standards, or reviewing code architecture.`
- Content: ALL of Domain 2 (sections 2.1 through 2.5). This includes WPCS, Static Analysis, Architecture & Design Patterns, Error Handling, and Deprecated & Removed Functions.
- Include the static analysis tool commands (PHPCS, PHPStan, PHP Linting) from the "Tool Usage" section.

**skills/performance/SKILL.md:**
- Frontmatter: `name: performance`, `description: Analyzes WordPress performance across database queries, PHP execution, frontend rendering, and caching layers. Use when investigating slow pages, optimizing load times, or reviewing caching strategy.`
- Content: ALL of Domain 3 (sections 3.1 through 3.4). This includes Database Performance, PHP Performance, Frontend Performance, and Caching Analysis.
- Include the database analysis WP-CLI commands from "Tool Usage" section (the SELECT queries for options size, transient count, revision count).

**skills/plugin-conflicts/SKILL.md:**
- Frontmatter: `name: plugin-conflicts`, `description: Identifies and resolves conflicts between WordPress plugins and themes. Use when debugging plugin conflicts, theme switching issues, or JavaScript/CSS collisions.`
- Content: ALL of Domain 4 (sections 4.1 through 4.3). This includes Conflict Identification, Systematic Conflict Testing, and Common Conflict Patterns.

Each skill file should be self-contained -- a developer or Claude instance reading just that one file should have complete knowledge of that diagnostic domain.
  </action>
  <verify>
For each skill file, verify:
1. YAML frontmatter has `name` and `description` fields
2. Content matches the original CLAUDE.md domain sections (spot-check key terms)
3. security-analysis contains "sanitize_text_field", "wp_verify_nonce", "base64_decode", "eval()"
4. code-quality contains "WordPress Coding Standards", "PHPStan", "PSR-4"
5. performance contains "N+1 query", "autoloading", "Core Web Vitals"
6. plugin-conflicts contains "Hook priority", "binary search isolation", "SEO plugins duplicating"
  </verify>
  <done>Four skill files created with complete diagnostic domain knowledge transferred from original CLAUDE.md. Each skill is self-contained with proper frontmatter for Claude auto-selection.</done>
</task>

</tasks>

<verification>
1. CLAUDE.md is under 120 lines and contains NO domain-specific diagnostic content
2. All four skill files exist in correct directories (skills/{name}/SKILL.md)
3. Each skill file has valid YAML frontmatter with name and description
4. Original CLAUDE.md content is preserved in skills -- nothing was lost in the migration
5. Spot-check: `grep -r "sanitize_text_field" skills/` finds it in security-analysis only
</verification>

<success_criteria>
- CLAUDE.md is lean identity/process/hot-cache (~60-100 lines, no diagnostic domains)
- Safe operation patterns (rsync dry-run, no --delete, credential safety) documented in CLAUDE.md
- Four skill files contain the COMPLETE content of Domains 1-4 from the original CLAUDE.md
- Each skill has proper YAML frontmatter (name + description) for Claude auto-selection
- No diagnostic knowledge was lost in the migration
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-foundation/01-02-SUMMARY.md`
</output>
